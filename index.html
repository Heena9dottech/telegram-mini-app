<!DOCTYPE html>
<html>
<head>
  <title>Heena Telegram Mini App</title>
</head>
<body>
  <h2 id="welcome"></h2>
  <p>This Mini App lets you access your trading dashboard directly in Telegram.</p>
  <p><strong>Click below to receive a welcome message with a shortcut to the app!</strong></p>

  <button onclick="sendTelegramMessage()">📲 Send Telegram Welcome</button>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const user = tg.initDataUnsafe?.user;
    const name = user?.first_name || 'User';
    const userId = user?.id;

    document.getElementById('welcome').innerText = `Welcome ${name} 👋`;

    function sendTelegramMessage() {
      if (!userId) {
        alert("User ID not found. Please open this app from Telegram.");
        return;
      }

      const botToken = '8128648073:AAFPXb7yx_qDGw-4YvxQ2ZP_VXdMAzXVZJA';
      const url = `https://api.telegram.org/bot${botToken}/sendMessage`;

      const payload = {
        chat_id: userId,
        text: `Hi ${name}! 👋\nWelcome to Heena Trade App.`,
        reply_markup: {
          inline_keyboard: [[
            {
              text: 'Open Mini App',
              web_app: {
                url: 'https://telegram-mini-app-heena.netlify.app'
              }
            }
          ]]
        }
      };

      fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
      })
      .then(res => res.json())
      .then(data => {
        console.log(data);
        alert("✅ Message sent to your Telegram!");
      })
      .catch(err => {
        console.error(err);
        alert("❌ Failed to send message.");
      });
    }
  </script>
</body>
</html>
